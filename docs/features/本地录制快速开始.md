# VideoPlat æœ¬åœ°å½•åˆ¶å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

- Docker å’Œ Docker Compose å·²å®‰è£…
- Agora APP ID å’Œ APP CERTIFICATE
- è‡³å°‘ 10GB å¯ç”¨ç£ç›˜ç©ºé—´

---

## ğŸ“ æ­¥éª¤ 1ï¼šé…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶å¹¶ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ Agora é…ç½®ï¼š

```bash
# Agora é…ç½®
AGORA_APP_ID=ä½ çš„_APP_ID
AGORA_APP_CERTIFICATE=ä½ çš„_APP_CERTIFICATE

# å½•åˆ¶æ¨¡å¼ï¼ˆæœ¬åœ°å½•åˆ¶ï¼‰
RECORDING_MODE=local
RECORDER_BIN_PATH=/app/agora_recorder/recorder_local
RECORDING_STORAGE_PATH=/app/recordings
```

---

## ğŸ“¦ æ­¥éª¤ 2ï¼šæ„å»º Docker é•œåƒ

```bash
# æ„å»ºåç«¯é•œåƒï¼ˆåŒ…å« Agora å½•åˆ¶ç¨‹åºï¼‰
docker-compose build backend

# æˆ–è€…æ„å»ºæ‰€æœ‰æœåŠ¡
docker-compose build
```

**æ³¨æ„ï¼š** é¦–æ¬¡æ„å»ºéœ€è¦ 5-10 åˆ†é’Ÿï¼Œå› ä¸ºéœ€è¦ç¼–è¯‘ Agora å½•åˆ¶ç¨‹åºã€‚

---

## ğŸ¬ æ­¥éª¤ 3ï¼šå¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs -f backend
```

---

## âœ… æ­¥éª¤ 4ï¼šéªŒè¯éƒ¨ç½²

### æ£€æŸ¥å½•åˆ¶ç¨‹åº

```bash
# æ£€æŸ¥å½•åˆ¶ç¨‹åºæ˜¯å¦å­˜åœ¨
docker exec videoplat-backend ls -la /app/agora_recorder/

# åº”è¯¥çœ‹åˆ°ï¼š
# -rwxr-xr-x 1 root root recorder_local
```

### æ£€æŸ¥åº“æ–‡ä»¶

```bash
# æ£€æŸ¥ Agora SDK åº“æ–‡ä»¶
docker exec videoplat-backend ls -la /usr/local/lib/

# åº”è¯¥çœ‹åˆ°ï¼š
# libagora-fdkaac.so
# libagora_rtc_sdk.so
# libaosl.so
```

### æ£€æŸ¥å½•åˆ¶ç›®å½•

```bash
# æ£€æŸ¥å½•åˆ¶ç›®å½•
docker exec videoplat-backend ls -la /app/recordings/
```

---

## ğŸ¥ æ­¥éª¤ 5ï¼šæµ‹è¯•å½•åˆ¶åŠŸèƒ½

### 1. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- HTTPS: https://localhost
- HTTP: http://localhostï¼ˆä¼šè‡ªåŠ¨é‡å®šå‘åˆ° HTTPSï¼‰

**æ³¨æ„ï¼š** é¦–æ¬¡è®¿é—®éœ€è¦ä¿¡ä»»è‡ªç­¾åè¯ä¹¦ã€‚

### 2. ç™»å½•ç³»ç»Ÿ

ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•ï¼š
- ç”¨æˆ·åï¼š`user1`
- å¯†ç ï¼š`password123`

### 3. åˆ›å»ºä¼šè®®å®¤

1. ç‚¹å‡»"åˆ›å»ºä¼šè®®å®¤"
2. è¾“å…¥ä¼šè®®å®¤åç§°
3. ç‚¹å‡»"åˆ›å»º"

### 4. å¼€å§‹å½•åˆ¶

1. è¿›å…¥ä¼šè®®å®¤
2. ç‚¹å‡»"å¼€å§‹å½•åˆ¶"æŒ‰é’®ï¼ˆä»…ä¸»æŒäººå¯è§ï¼‰
3. ç­‰å¾…å½•åˆ¶å¯åŠ¨ï¼ˆçº¦ 2-3 ç§’ï¼‰
4. çœ‹åˆ°"å½•åˆ¶ä¸­"æŒ‡ç¤ºå™¨

### 5. è¿›è¡Œä¼šè®®

- è‡³å°‘è¿›è¡Œ 30 ç§’çš„ä¼šè®®
- å¯ä»¥é‚€è¯·å…¶ä»–ç”¨æˆ·åŠ å…¥
- å½•åˆ¶ä¼šè‡ªåŠ¨æ•è·æ‰€æœ‰å‚ä¸è€…çš„éŸ³è§†é¢‘

### 6. åœæ­¢å½•åˆ¶

1. ç‚¹å‡»"åœæ­¢å½•åˆ¶"æŒ‰é’®
2. ç­‰å¾…å½•åˆ¶åœæ­¢ï¼ˆçº¦ 2-3 ç§’ï¼‰
3. å½•åˆ¶æ–‡ä»¶è‡ªåŠ¨ä¿å­˜

### 7. æŸ¥çœ‹å½•åˆ¶æ–‡ä»¶

```bash
# æŸ¥çœ‹å½•åˆ¶æ–‡ä»¶åˆ—è¡¨
docker exec videoplat-backend ls -lh /app/recordings/

# å¤åˆ¶å½•åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°
docker cp videoplat-backend:/app/recordings/xxx.mp4 ./
```

---

## ğŸ“Š æŸ¥çœ‹æ—¥å¿—

### åç«¯æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs -f backend

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker-compose logs --tail=100 backend

# æœç´¢å½•åˆ¶ç›¸å…³æ—¥å¿—
docker-compose logs backend | grep "å½•åˆ¶"
```

### å½•åˆ¶è¿›ç¨‹æ—¥å¿—

å½•åˆ¶è¿›ç¨‹çš„è¾“å‡ºä¼šè‡ªåŠ¨è®°å½•åˆ°åç«¯æ—¥å¿—ä¸­ï¼Œæœç´¢ `[Recorder-{roomId}]` å¯ä»¥çœ‹åˆ°ï¼š

```
[Recorder-9351e742] å¼€å§‹äº‘ç«¯å½•åˆ¶...
[Recorder-9351e742] è¿æ¥åˆ°é¢‘é“æˆåŠŸ
[Recorder-9351e742] ç”¨æˆ·åŠ å…¥: 123456
[Recorder-9351e742] å½•åˆ¶æ–‡ä»¶: /app/recordings/xxx.mp4
```

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: å½•åˆ¶æŒ‰é’®ä¸æ˜¾ç¤ºï¼Ÿ

**åŸå› ï¼š** åªæœ‰ä¸»æŒäººï¼ˆåˆ›å»ºä¼šè®®å®¤çš„ç”¨æˆ·ï¼‰å¯ä»¥çœ‹åˆ°å½•åˆ¶æŒ‰é’®ã€‚

**è§£å†³ï¼š** ä½¿ç”¨åˆ›å»ºä¼šè®®å®¤çš„è´¦å·ç™»å½•ã€‚

---

### Q2: ç‚¹å‡»"å¼€å§‹å½•åˆ¶"åæ²¡æœ‰ååº”ï¼Ÿ

**æ£€æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs backend | grep "å½•åˆ¶"

# 2. æ£€æŸ¥å½•åˆ¶ç¨‹åº
docker exec videoplat-backend ls -la /app/agora_recorder/recorder_local

# 3. æ£€æŸ¥å½•åˆ¶ç¨‹åºæƒé™
docker exec videoplat-backend chmod +x /app/agora_recorder/recorder_local

# 4. é‡å¯åç«¯æœåŠ¡
docker-compose restart backend
```

---

### Q3: å½•åˆ¶æ–‡ä»¶ä¸å­˜åœ¨ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
1. å½•åˆ¶æ—¶é—´å¤ªçŸ­ï¼ˆå°‘äº 3 ç§’ï¼‰
2. å½•åˆ¶è¿›ç¨‹å¼‚å¸¸é€€å‡º
3. æ²¡æœ‰ç”¨æˆ·åŠ å…¥ä¼šè®®

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æŸ¥çœ‹å½•åˆ¶è¿›ç¨‹æ—¥å¿—
docker-compose logs backend | grep "Recorder"

# æ£€æŸ¥å½•åˆ¶ç›®å½•
docker exec videoplat-backend ls -la /app/recordings/
```

---

### Q4: æ„å»º Docker é•œåƒå¤±è´¥ï¼Ÿ

**é”™è¯¯ï¼š** `COPY failed: file not found in build context`

**åŸå› ï¼š** `agora_rtc_sdk` ç›®å½•ä¸å­˜åœ¨

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥ç›®å½•
ls -la backend/agora_rtc_sdk/

# å¦‚æœä¸å­˜åœ¨ï¼Œå¤åˆ¶ SDK
cp -r E:/file/program/claude/tools/agora_rtc_sdk backend/
```

---

### Q5: åº“æ–‡ä»¶æ‰¾ä¸åˆ°ï¼Ÿ

**é”™è¯¯ï¼š** `error while loading shared libraries: libagora_rtc_sdk.so`

**è§£å†³ï¼š**
```bash
# é‡æ–°æ„å»ºé•œåƒï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose build --no-cache backend

# é‡å¯æœåŠ¡
docker-compose up -d
```

---

## ğŸ¯ å½•åˆ¶æ¨¡å¼åˆ‡æ¢

### åˆ‡æ¢åˆ°äº‘ç«¯å½•åˆ¶

å¦‚æœä½ æƒ³ä½¿ç”¨äº‘ç«¯å½•åˆ¶è€Œä¸æ˜¯æœ¬åœ°å½•åˆ¶ï¼š

1. é…ç½®äº‘å­˜å‚¨ï¼ˆé˜¿é‡Œäº‘ OSS/AWS S3ï¼‰
2. ä¿®æ”¹ `.env` æ–‡ä»¶ï¼š

```bash
# åˆ‡æ¢åˆ°äº‘ç«¯å½•åˆ¶
RECORDING_MODE=cloud

# é…ç½®äº‘å­˜å‚¨
CLOUD_STORAGE_ACCESS_KEY=ä½ çš„_ACCESS_KEY
CLOUD_STORAGE_SECRET_KEY=ä½ çš„_SECRET_KEY
```

3. é‡å¯æœåŠ¡ï¼š

```bash
docker-compose restart backend
```

---

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹åç«¯å®¹å™¨èµ„æºä½¿ç”¨
docker stats videoplat-backend
```

### æŸ¥çœ‹ç£ç›˜ä½¿ç”¨

```bash
# æŸ¥çœ‹å½•åˆ¶æ–‡ä»¶å ç”¨ç©ºé—´
docker exec videoplat-backend du -sh /app/recordings/

# æŸ¥çœ‹ Docker Volume ä½¿ç”¨
docker volume ls
docker volume inspect recordings_data
```

---

## ğŸ§¹ æ¸…ç†å’Œç»´æŠ¤

### æ¸…ç†å½•åˆ¶æ–‡ä»¶

```bash
# åˆ é™¤æ‰€æœ‰å½•åˆ¶æ–‡ä»¶
docker exec videoplat-backend rm -rf /app/recordings/*

# åˆ é™¤ 7 å¤©å‰çš„å½•åˆ¶æ–‡ä»¶
docker exec videoplat-backend find /app/recordings/ -name "*.mp4" -mtime +7 -delete
```

### æ¸…ç† Docker èµ„æº

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åˆ é™¤æ‰€æœ‰å®¹å™¨å’Œç½‘ç»œ
docker-compose down -v

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a
```

---

## ğŸ“š æ›´å¤šä¿¡æ¯

- **å®Œæ•´æ–‡æ¡£ï¼š** `Agoraæœ¬åœ°å½•åˆ¶é›†æˆå®ŒæˆæŠ¥å‘Š.md`
- **API æ–‡æ¡£ï¼š** http://localhost:8080/swagger-ui.html
- **å¥åº·æ£€æŸ¥ï¼š** http://localhost:8080/actuator/health

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs backend`
2. æ£€æŸ¥é…ç½®ï¼š`cat .env`
3. éªŒè¯éƒ¨ç½²ï¼šæŒ‰ç…§"æ­¥éª¤ 4"æ£€æŸ¥
4. æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š`Agoraæœ¬åœ°å½•åˆ¶é›†æˆå®ŒæˆæŠ¥å‘Š.md`

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
