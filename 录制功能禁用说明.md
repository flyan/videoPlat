# 录制功能禁用说明

## 修改日期
2026-02-09

## 修改原因
录制服务（本地和云端）目前都无法正常工作，因此禁用录制功能。

## 修改内容

### 1. 后端修改

#### 1.1 配置文件修改
**文件**: `backend/videoplat-application/src/main/resources/application.yml`

```yaml
# 会议录制配置（已禁用）
recording:
  enabled: false  # 禁用录制功能
  storage-path: ${RECORDING_STORAGE_PATH:/app/recordings}
  max-size-gb: ${RECORDING_MAX_SIZE_GB:100}
  mode: ${RECORDING_MODE:disabled}  # 录制模式：disabled（已禁用）
  recorder-bin-path: ${RECORDER_BIN_PATH:/app/agora_recorder/recorder_local}
```

#### 1.2 录制控制器修改
**文件**: `backend/videoplat-meeting/src/main/java/com/videoplat/meeting/controller/RecordingController.java`

- 所有 API 端点保留，但返回"录制功能已禁用"错误消息
- 修改的端点：
  - `POST /api/rooms/{roomId}/recordings/start` - 开始录制
  - `POST /api/rooms/{roomId}/recordings/stop` - 停止录制
  - `GET /api/recordings` - 获取录制列表
  - `GET /api/recordings/{recordingId}` - 获取录制详情
  - `GET /api/recordings/{recordingId}/stream` - 流式播放录制
  - `DELETE /api/recordings/{recordingId}` - 删除录制

### 2. 前端修改

#### 2.1 路由配置修改
**文件**: `frontend/src/App.jsx`

- 注释掉用户录制页面路由: `/recordings`
- 注释掉管理台录制页面路由: `/admin/recordings`
- 注释掉相关组件导入

#### 2.2 会议室页面修改
**文件**: `frontend/src/pages/Room.jsx`

- 注释掉录制服务导入
- 修改 `handleToggleRecording` 函数，点击录制按钮时显示"录制功能已禁用"提示
- 保留录制按钮 UI，但功能已禁用

#### 2.3 首页修改
**文件**: `frontend/src/pages/Home.jsx`

- 注释掉顶部导航栏的"录制记录"按钮
- 注释掉快速访问区域的"录制记录"卡片

#### 2.4 管理台布局修改
**文件**: `frontend/src/pages/admin/AdminLayout.jsx`

- 注释掉侧边栏的"录制管理"菜单项

## 构建和部署

### 使用 Docker Compose 构建

```bash
# 停止现有服务
docker-compose down

# 重新构建镜像（不使用缓存）
docker-compose build --no-cache

# 启动服务
docker-compose up -d

# 查看日志
docker-compose logs -f
```

### 验证方法

#### 前端验证
1. 访问首页 (http://localhost 或 https://192.168.10.9)
2. 确认"录制记录"按钮已消失
3. 进入会议室，点击录制按钮会提示"录制功能已禁用"
4. 访问管理台，确认侧边栏不再显示"录制管理"选项

#### 后端验证
1. 访问 Swagger UI: http://localhost:8080/swagger-ui.html
2. 尝试调用录制相关的 API 端点
3. 确认返回"录制功能已禁用"错误消息

## 注意事项

### 保留的功能
- 录制相关的数据库表和实体类保留
- 录制服务类 (RecordingService) 保留
- 录制 API 端点保留（但返回错误）
- 前端录制按钮 UI 保留（但功能禁用）

### 为什么不完全删除？
1. **便于将来恢复**: 如果录制服务修复，可以快速重新启用
2. **保持代码完整性**: 避免大规模删除导致的依赖问题
3. **数据保留**: 已有的录制记录数据不会丢失

## 如何重新启用录制功能

如果将来需要重新启用录制功能：

### 后端
1. 修改 `application.yml`:
   ```yaml
   recording:
     enabled: true
     mode: local  # 或 cloud
   ```

2. 恢复 `RecordingController.java` 中的原始代码

### 前端
1. 取消注释 `App.jsx` 中的录制路由
2. 取消注释 `Room.jsx` 中的录制功能代码
3. 取消注释 `Home.jsx` 中的录制入口
4. 取消注释 `AdminLayout.jsx` 中的录制管理菜单

### 重新构建
```bash
docker-compose build --no-cache
docker-compose up -d
```

## 相关文件清单

### 后端文件
- `backend/videoplat-application/src/main/resources/application.yml`
- `backend/videoplat-meeting/src/main/java/com/videoplat/meeting/controller/RecordingController.java`
- `backend/videoplat-meeting/src/main/java/com/videoplat/meeting/service/RecordingService.java` (未修改)
- `backend/videoplat-meeting/src/main/java/com/videoplat/meeting/service/AgoraCloudRecordingService.java` (未修改)
- `backend/videoplat-meeting/src/main/java/com/videoplat/meeting/service/LocalRecordingService.java` (未修改)

### 前端文件
- `frontend/src/App.jsx`
- `frontend/src/pages/Room.jsx`
- `frontend/src/pages/Home.jsx`
- `frontend/src/pages/admin/AdminLayout.jsx`
- `frontend/src/pages/Recordings.jsx` (未修改，但路由已禁用)
- `frontend/src/pages/admin/Recordings.jsx` (未修改，但路由已禁用)

## 技术支持

如有问题，请检查：
1. Docker 容器是否正常运行: `docker-compose ps`
2. 后端日志: `docker-compose logs backend`
3. 前端日志: `docker-compose logs frontend`
4. 浏览器控制台是否有错误信息
